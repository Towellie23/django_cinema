from django.core.management.base import BaseCommand
from app.models import Movie, Director, Actor, Genre
from datetime import datetime

popular_movies = [
    {
        "movie_name": "Побег из Шоушенка",
        "description": "Два заключенных за долгие годы находят утешение и в конце концов искупление через акты общей порядочности.",
        "director": "Фрэнк Дарабонт",
        "actors": ["Тим Роббинс", "Морган Фриман"],
        "genres": ["Драма"],
        "release_date": "1994-09-23"
    },
    {
        "movie_name": "Крестный отец",
        "description": "Стареющий патриарх преступного клана передает управление своей тайной империей своему неохотному сыну.",
        "director": "Фрэнсис Форд Коппола",
        "actors": ["Марлон Брандо", "Аль Пачино"],
        "genres": ["Криминал", "Драма"],
        "release_date": "1972-03-24"
    },
    {
        "movie_name": "Темный рыцарь",
        "description": "Когда появляется угроза в лице Джокера, Бэтмен должен противостоять хаосу и анархии в Готэм-Сити.",
        "director": "Кристофер Нолан",
        "actors": ["Кристиан Бейл", "Хит Леджер"],
        "genres": ["Экшн", "Криминал", "Драма"],
        "release_date": "2008-07-18"
    },
    {
        "movie_name": "Криминальное чтиво",
        "description": "Жизни двух киллеров, боксёра, жены гангстера и пары обывателей переплетаются в четырех рассказах о насилии и искуплении.",
        "director": "Квентин Тарантино",
        "actors": ["Джон Траволта", "Ума Турман"],
        "genres": ["Криминал", "Драма"],
        "release_date": "1994-10-14"
    },
    {
        "movie_name": "Форрест Гамп",
        "description": "Президенства Кеннеди и Джонсона, события во Вьетнаме, Уотергейта и другие исторические события раскрываются через призму жителя Алабамы с IQ 75.",
        "director": "Роберт Земекис",
        "actors": ["Том Хэнкс", "Робин Райт"],
        "genres": ["Драма", "Романтика"],
        "release_date": "1994-07-06"
    },
    {
        "movie_name": "Начало",
        "description": "Вор, крадущий корпоративные секреты с помощью технологии обмена сновидениями, получает обратную задачу - внедрить идею в разум генерального директора.",
        "director": "Кристофер Нолан",
        "actors": ["Леонардо ДиКаприо", "Джозеф Гордон-Левитт"],
        "genres": ["Экшн", "Приключения", "Фантастика"],
        "release_date": "2010-07-16"
    },
    {
        "movie_name": "Матрица",
        "description": "Хакер узнает от загадочных повстанцев правду о своей реальности и своей роли в войне против ее контролеров.",
        "director": "Лана Вачовски",
        "actors": ["Киану Ривз", "Лоуренс Фишбёрн"],
        "genres": ["Экшн", "Фантастика"],
        "release_date": "1999-03-31"
    },
    {
        "movie_name": "Интерстеллар",
        "description": "Команда исследователей путешествует через червоточину в космосе, пытаясь обеспечить выживание человечества.",
        "director": "Кристофер Нолан",
        "actors": ["Мэттью МакКонахи", "Энн Хэтэуэй"],
        "genres": ["Приключения", "Драма", "Фантастика"],
        "release_date": "2014-11-07"
    },
    {
        "movie_name": "Бойцовский клуб",
        "description": "Офисный работник с бессонницей и бесшабашный мыловар создают подпольный бойцовский клуб, который перерастает во что-то гораздо большее.",
        "director": "Дэвид Финчер",
        "actors": ["Брэд Питт", "Эдвард Нортон"],
        "genres": ["Драма"],
        "release_date": "1999-10-15"
    },
    {
        "movie_name": "Властелин колец: Возвращение короля",
        "description": "Гэндальф и Арагорн ведут войну против армии Саурона, чтобы отвлечь его внимание от Фродо и Сэма, которые приближаются к Горе Рока с Единственным Кольцом.",
        "director": "Питер Джексон",
        "actors": ["Элайджа Вуд", "Вигго Мортенсен"],
        "genres": ["Приключения", "Драма", "Фэнтези"],
        "release_date": "2003-12-17"
    },
    {
        "movie_name": "Мстители",
        "description": "Самые могущественные герои Земли должны объединиться и научиться сражаться как команда, чтобы остановить коварного Локи и его инопланетную армию от порабощения человечества.",
        "director": "Джосс Уидон",
        "actors": ["Роберт Дауни мл.", "Крис Эванс"],
        "genres": ["Экшн", "Приключения", "Фантастика"],
        "release_date": "2012-05-04"
    },
    {
        "movie_name": "Титаник",
        "description": "Семнадцатилетняя аристократка влюбляется в доброго, но бедного художника на борту роскошного, обреченного R.M.S. Титаник.",
        "director": "Джеймс Кэмерон",
        "actors": ["Леонардо ДиКаприо", "Кейт Уинслет"],
        "genres": ["Драма", "Романтика"],
        "release_date": "1997-12-19"
    },
    {
        "movie_name": "Гладиатор",
        "description": "Бывший римский генерал намерен отомстить коррумпированному императору, который убил его семью и отправил его в рабство.",
        "director": "Ридли Скотт",
        "actors": ["Рассел Кроу", "Хоакин Феникс"],
        "genres": ["Экшн", "Приключения", "Драма"],
        "release_date": "2000-05-05"
    },
    {
        "movie_name": "Король Лев",
        "description": "Лев-принц Симба и его отец становятся целью его злобного дяди, который сам хочет взойти на трон.",
        "director": "Роджер Аллерс",
        "actors": ["Мэттью Бродерик", "Джереми Айронс"],
        "genres": ["Анимация", "Приключения", "Драма"],
        "release_date": "1994-06-24"
    },
    {
        "movie_name": "Социальная сеть",
        "description": "Когда студент Гарварда Марк Цукерберг создает социальную сеть, которая станет известна как Facebook, он сталкивается с судебными исками от близнецов, утверждающих, что он украл их идею, и от сооснователя, который позже был вытеснен из бизнеса.",
        "director": "Дэвид Финчер",
        "actors": ["Джесси Айзенберг", "Эндрю Гарфилд"],
        "genres": ["Биография", "Драма"],
        "release_date": "2010-10-01"
    },
    {
        "movie_name": "Волк с Уолл-стрит",
        "description": "Основанная на реальной истории Джордана Белфорта, начиная с его восхождения к богатому биржевому брокеру, живущему на широкую ногу, до его падения, связанного с преступлениями, коррупцией и федеральным правительством.",
        "director": "Мартин Скорсезе",
        "actors": ["Леонардо ДиКаприо", "Джона Хилл"],
        "genres": ["Биография", "Комедия", "Криминал"],
        "release_date": "2013-12-25"
    }
]

class Command(BaseCommand):
    help = 'Populates the database with popular movies'

    def handle(self, *args, **kwargs):
        for movie_data in popular_movies:
            director, _ = Director.objects.get_or_create(
                name=movie_data["director"],
                defaults={"age": 50, "sex": "Male", "film_count": 1}
            )

            movie = Movie.objects.create(
                movie_name=movie_data["movie_name"],
                description=movie_data["description"],
                director=director,
                release_date=datetime.strptime(movie_data["release_date"], "%Y-%m-%d").date()
            )

            for actor_name in movie_data["actors"]:
                actor, _ = Actor.objects.get_or_create(
                    name=actor_name,
                    defaults={"age": 40, "sex": "Male", "oscars": 0}
                )
                movie.actors.add(actor)

            for genre_name in movie_data["genres"]:
                genre, _ = Genre.objects.get_or_create(
                    genre_name=genre_name,
                    defaults={"pg_rating": 13}
                )
                movie.genres.add(genre)

            self.stdout.write(self.style.SUCCESS(f"Added: {movie.movie_name}"))